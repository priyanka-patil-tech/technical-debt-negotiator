<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tech Debt Negotiator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
:root {
  /* Core palette â€” deep navy IDE meets JIRA blue */
  --bg:        #0d1117;
  --surface:   #161c26;
  --surface2:  #1c2333;
  --surface3:  #212d40;
  --border:    #2a3547;
  --border2:   #364055;
  --dim:       #5c6e8a;
  --muted:     #8899b0;
  --soft:      #c2cfe0;
  --text:      #e2ecf8;

  /* Accent â€” JIRA-ish cobalt blue shifted to teal-blue */
  --accent:    #3b82f6;
  --accent2:   #60a5fa;
  --accent-bg: rgba(59,130,246,.1);

  /* Semantic colors */
  --red:       #f87171;
  --red-bg:    rgba(248,113,113,.1);
  --red-border:rgba(248,113,113,.3);
  --amber:     #fbbf24;
  --amber-bg:  rgba(251,191,36,.1);
  --amber-border:rgba(251,191,36,.3);
  --green:     #34d399;
  --green-bg:  rgba(52,211,153,.1);
  --green-border:rgba(52,211,153,.3);
  --blue:      #60a5fa;
  --blue-bg:   rgba(96,165,250,.1);
  --blue-border:rgba(96,165,250,.3);

  --radius:    8px;
  --radius-sm: 5px;
  --radius-lg: 12px;

  --shadow:    0 1px 3px rgba(0,0,0,.4), 0 4px 12px rgba(0,0,0,.25);
  --shadow-md: 0 4px 16px rgba(0,0,0,.4), 0 1px 3px rgba(0,0,0,.3);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
  font-size: 13px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ Shell â”€â”€ */
.shell { display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

/* â”€â”€ Topbar â”€â”€ */
.topbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 20px; height: 52px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.logo { display: flex; align-items: center; gap: 10px; }
.logo-mark {
  width: 30px; height: 30px;
  background: linear-gradient(135deg, var(--accent), #6366f1);
  border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; font-weight: 700; color: #fff;
  box-shadow: 0 2px 8px rgba(59,130,246,.4);
}
.logo-text { font-size: 15px; font-weight: 600; color: var(--text); letter-spacing: -.2px; }
.logo-text span { color: var(--accent2); }
.badge {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; font-weight: 500;
  padding: 2px 8px;
  border: 1px solid;
  border-radius: 20px;
  letter-spacing: .04em;
}
.badge-live   { color: var(--green); border-color: var(--green-border); background: var(--green-bg); }
.badge-warn   { color: var(--amber); border-color: var(--amber-border); background: var(--amber-bg); }
.badge-info   { color: var(--blue);  border-color: var(--blue-border);  background: var(--blue-bg); }

/* â”€â”€ Body Layout â”€â”€ */
.body-layout { display: flex; flex: 1; overflow: hidden; }
.main-area {
  flex: 1; overflow-y: auto;
  padding: 16px 20px;
  display: flex; flex-direction: column; gap: 12px;
}
.log-panel {
  width: 300px; flex-shrink: 0;
  border-left: 1px solid var(--border);
  background: var(--surface);
  display: flex; flex-direction: column;
}
.log-panel-header {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; color: var(--dim);
  letter-spacing: .1em; text-transform: uppercase;
  display: flex; justify-content: space-between; align-items: center;
}
.log-panel-body { flex: 1; overflow-y: auto; padding: 10px 14px; }
.log-line { font-family: 'JetBrains Mono', monospace; font-size: 10px; line-height: 1.9; }
.log-ok    { color: var(--green); }
.log-info  { color: var(--blue); }
.log-warn  { color: var(--amber); }
.log-error { color: var(--red); }
.log-dim   { color: var(--dim); }

/* â”€â”€ Cards â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow);
}
.card-head {
  padding: 12px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  background: var(--surface2);
}
.card-title {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; letter-spacing: .1em; text-transform: uppercase; color: var(--muted);
}
.card-body { padding: 18px; }

/* â”€â”€ Buttons â”€â”€ */
.btn {
  padding: 8px 18px;
  cursor: pointer; border: none;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 12px; font-weight: 600;
  letter-spacing: .01em;
  border-radius: var(--radius);
  transition: all .18s ease;
  display: inline-flex; align-items: center; gap: 7px;
}
.btn-primary {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 2px 8px rgba(59,130,246,.35);
}
.btn-primary:hover:not(:disabled) { background: #2563eb; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(59,130,246,.45); }
.btn-primary:disabled { background: var(--surface3); color: var(--dim); cursor: not-allowed; box-shadow: none; }
.btn-secondary {
  background: var(--surface2);
  color: var(--soft);
  border: 1px solid var(--border);
}
.btn-secondary:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }
.btn-success {
  background: var(--green);
  color: #0a1a14;
  font-weight: 700;
  box-shadow: 0 2px 8px rgba(52,211,153,.3);
}
.btn-success:hover { filter: brightness(1.08); transform: translateY(-1px); }
.btn-blue { background: var(--blue); color: #0d1831; }
.btn-blue:hover { filter: brightness(1.1); transform: translateY(-1px); }
.btn-block { width: 100%; justify-content: center; }

/* â”€â”€ JIRA cards â”€â”€ */
.jira-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.jira-card {
  padding: 14px 16px;
  border: 1px solid var(--border);
  border-left: 4px solid var(--border2);
  border-radius: var(--radius);
  background: var(--surface);
  cursor: pointer;
  transition: all .2s ease;
  display: flex; flex-direction: column; gap: 8px;
  box-shadow: var(--shadow);
}
.jira-card:hover { border-left-color: var(--accent); background: var(--surface2); transform: translateY(-1px); box-shadow: var(--shadow-md); }
.jira-card.selected { border-left-color: var(--accent) !important; background: color-mix(in srgb, var(--accent) 8%, var(--surface)); box-shadow: 0 0 0 1px var(--accent), var(--shadow-md); }
.jira-card.priority-critical { border-left-color: var(--red); }
.jira-card.priority-high     { border-left-color: var(--amber); }
.jira-card.priority-medium   { border-left-color: var(--blue); }
.jira-card:hover { border-left-color: var(--accent) !important; }
.jira-key { font-family: 'JetBrains Mono', monospace; font-size: 10px; font-weight: 500; color: var(--accent2); }
.jira-title { font-size: 12.5px; color: var(--soft); line-height: 1.55; flex: 1; }
.jira-priority {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; font-weight: 500;
  padding: 2px 8px;
  border: 1px solid;
  border-radius: 20px;
  text-transform: uppercase; letter-spacing: .04em;
}
.priority-critical { color: var(--red);   border-color: var(--red-border);   background: var(--red-bg); }
.priority-high     { color: var(--amber); border-color: var(--amber-border); background: var(--amber-bg); }
.priority-medium   { color: var(--blue);  border-color: var(--blue-border);  background: var(--blue-bg); }

/* â”€â”€ Debt items â”€â”€ */
.debt-row {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 14px 16px;
  border: 1px solid var(--border);
  border-left: 4px solid var(--border2);
  border-radius: var(--radius);
  background: var(--surface);
  margin-bottom: 8px;
  transition: all .2s;
}
.debt-row.critical { border-left-color: var(--red); }
.debt-row.high     { border-left-color: var(--amber); }
.debt-row.medium   { border-left-color: var(--blue); }
.debt-checkbox {
  width: 15px; height: 15px; cursor: pointer; margin-top: 3px;
  accent-color: var(--accent); flex-shrink: 0;
}
.debt-info { flex: 1; }
.debt-type-tag { font-family: 'JetBrains Mono', monospace; font-size: 9px; font-weight: 700; text-transform: uppercase; }
.debt-type-tag.critical { color: var(--red); }
.debt-type-tag.high     { color: var(--amber); }
.debt-type-tag.medium   { color: var(--blue); }
.debt-desc { font-size: 12.5px; color: var(--soft); margin: 4px 0; line-height: 1.6; }
.debt-loc { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--dim); }
.debt-cost-tag { text-align: right; flex-shrink: 0; }
.debt-cost-num { font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 600; color: var(--red); }
.debt-effort { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--dim); margin-top: 2px; }

/* â”€â”€ Repo display â”€â”€ */
.repo-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 12px 16px;
  display: flex; align-items: center; gap: 12px;
  font-family: 'JetBrains Mono', monospace; font-size: 12px;
}
.repo-icon { font-size: 18px; }
.repo-name { color: var(--accent2); font-weight: 500; }

/* â”€â”€ KPI boxes â”€â”€ */
.kpi-grid { display: grid; gap: 12px; }
.kpi-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
}
.kpi-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; color: var(--dim); letter-spacing: .1em; text-transform: uppercase; margin-bottom: 6px;
}
.kpi-val { font-size: 26px; line-height: 1.1; font-weight: 700; letter-spacing: -.5px; }
.kpi-val.red   { color: var(--red); }
.kpi-val.green { color: var(--green); }
.kpi-val.amber { color: var(--amber); }
.kpi-val.blue  { color: var(--blue); }
.kpi-sub { font-size: 10.5px; color: var(--dim); margin-top: 3px; }

/* â”€â”€ Negotiation cards â”€â”€ */
.nego-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 16px; align-items: start; }
.nego-vs { padding-top: 50px; font-size: 22px; font-weight: 700; color: var(--border2); text-align: center; }
.nego-card { border: 1.5px solid; padding: 18px; border-radius: var(--radius); }
.nego-card.opt-a { border-color: var(--red-border); background: var(--red-bg); }
.nego-card.opt-b { border-color: var(--green-border); background: var(--green-bg); }
.nego-card-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: .15em; text-transform: uppercase; margin-bottom: 6px; font-weight: 600;
}
.nego-card-label.a { color: var(--red); }
.nego-card-label.b { color: var(--green); }
.nego-card-title { font-size: 16px; font-weight: 700; margin-bottom: 14px; }
.nego-stat {
  display: flex; justify-content: space-between;
  padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 11.5px;
}
.nego-stat:last-child { border-bottom: none; }
.nego-stat-label { color: var(--muted); }
.nego-stat-val { font-family: 'JetBrains Mono', monospace; font-size: 11px; }

/* â”€â”€ Final dashboard â”€â”€ */
.final-kpi-grid { display: grid; grid-template-columns: repeat(5,1fr); gap: 10px; }
.final-kpi {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
}

/* â”€â”€ Recommendation box â”€â”€ */
.rec-box {
  padding: 18px 22px;
  border: 1px solid var(--green-border);
  border-left: 4px solid var(--green);
  background: var(--green-bg);
  border-radius: var(--radius);
}
.rec-label { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--green); letter-spacing: .12em; margin-bottom: 6px; font-weight: 600; }
.rec-title { font-size: 17px; font-weight: 700; margin-bottom: 8px; }
.rec-body { font-size: 12.5px; color: var(--soft); line-height: 1.75; }

/* â”€â”€ Section headers â”€â”€ */
.section-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; letter-spacing: -.3px; }
.section-sub { font-size: 11.5px; color: var(--dim); margin-bottom: 14px; }

/* â”€â”€ Layouts â”€â”€ */
.two-col   { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

/* â”€â”€ Pills â”€â”€ */
.pill {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; padding: 2px 8px;
  letter-spacing: .04em; text-transform: uppercase;
  border-radius: 20px; font-weight: 600;
}
.pill-red   { background: var(--red-bg);   color: var(--red);   border: 1px solid var(--red-border); }
.pill-amber { background: var(--amber-bg); color: var(--amber); border: 1px solid var(--amber-border); }
.pill-blue  { background: var(--blue-bg);  color: var(--blue);  border: 1px solid var(--blue-border); }
.pill-green { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-border); }

/* â”€â”€ Animations â”€â”€ */
@keyframes fadeIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }
@keyframes spin   { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }
@keyframes pulse  { 0%,100%{opacity:1;} 50%{opacity:.4;} }
.fade-in { animation: fadeIn .3s ease both; }
.spin    { display:inline-block; animation:spin 1s linear infinite; }
.pulse   { animation:pulse 1.5s ease infinite; }

/* â”€â”€ Progress â”€â”€ */
.prog-bar  { height: 4px; background: var(--surface3); border-radius: 2px; overflow: hidden; }
.prog-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width .4s ease; }

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--surface3); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--border2); }

/* â”€â”€ Responsive (mobile) â”€â”€ */
@media (max-width: 768px) {
  /* Topbar + stepper stay fixed; .main-area scrolls inside the shell.
     This mirrors how desktop works â€” no fighting with html/body overflow. */
  .body-layout { flex-direction: column; overflow: hidden; }
  .main-area {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 12px 14px;
  }

  /* Hide log panel */
  .log-panel { display: none !important; }

  /* Topbar */
  .topbar { height: auto; min-height: 48px; padding: 8px 14px; flex-wrap: wrap; gap: 6px; }

  /* Stepper â€” horizontal scroll, hide text labels to save space */
  .stepper { overflow-x: auto; height: auto; min-height: 52px; padding: 0 10px; }
  .step-label { display: none; }
  .step-line { min-width: 8px; }

  /* Landing */
  .landing { padding: 20px 14px; }
  .landing-title { font-size: 28px; letter-spacing: -.4px; }
  .landing-sub { font-size: 13px; margin-bottom: 16px; }
  .product-grid { grid-template-columns: 1fr; gap: 6px; }
  .product-card { border-radius: 10px; }
  .product-card-header { padding: 8px 12px; }
  .product-card-icon { font-size: 16px; }
  .product-card-name { font-size: 11px; font-weight: 700; letter-spacing: -.1px; }
  .product-card-tag { font-size: 7px; padding: 2px 6px; }
  .product-card-body { padding: 6px 12px 8px; gap: 4px; }
  .product-card-desc { font-size: 10px; line-height: 1.4; }
  .product-card-stats { padding-top: 6px; gap: 10px; margin-top: 0; }
  .product-stat { font-size: 9px; }
  .product-stat strong { font-size: 11px; margin-bottom: 0; }
  .product-card-cta { display: none; }

  /* Grids â†’ collapse */
  .jira-grid     { grid-template-columns: 1fr; }
  .two-col       { grid-template-columns: 1fr; }
  .three-col     { grid-template-columns: 1fr 1fr; }
  .nego-grid     { grid-template-columns: 1fr; }
  .nego-vs       { padding-top: 0; text-align: left; }

  /* Inline-styled grids â€” overridden via classNames added in JSX */
  .dash-kpi-row      { grid-template-columns: repeat(2, 1fr) !important; }
  .nego-bullets-grid { grid-template-columns: 1fr !important; }

  /* JIRA URL row â€” allow wrapping */
  .jira-url-row { flex-wrap: wrap; }
  .jira-url-row > a { flex: 1; text-align: center; }

  /* Phase header top row â€” button wraps below title on small screens */
  .phase-header-top { flex-wrap: wrap; }
  .phase-header-top .btn { flex: 1 0 100%; margin-top: 8px; justify-content: center; }

  /* Phase header â€” smaller on mobile */
  .phase-header { flex-wrap: wrap; padding: 6px 10px; gap: 8px; margin-bottom: 6px; }
  .phase-icon { font-size: 14px !important; }
  .phase-title { font-size: 13px !important; }
  .phase-sub { font-size: 10px !important; margin-top: 1px !important; }

  /* Debt list â€” unconstrain height, let .main-area handle the scroll */
  .debt-list { max-height: none !important; overflow-y: visible !important; }

  /* Requested Features items */
  .feature-item { padding: 7px 10px !important; gap: 8px !important; margin-bottom: 4px !important; }
  .feature-item .jira-key { font-size: 9px; }
  .feature-item-title { font-size: 11px !important; }

  /* Buttons */
  .btn { min-height: 40px; }

}

/* â”€â”€ Stepper â”€â”€ */
.stepper {
  display: flex; align-items: center;
  padding: 0 24px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0; height: 56px; overflow: hidden;
}
.step { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
.step-dot {
  width: 28px; height: 28px;
  border-radius: 50%;
  border: 2px solid var(--border2);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; color: var(--dim);
  background: var(--surface2); flex-shrink: 0;
  transition: all .3s;
}
.step.done .step-dot   { border-color: var(--green); background: var(--green-bg); color: var(--green); font-size: 10px; }
.step.active .step-dot { border-color: var(--accent); background: var(--accent-bg); color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,.18); }
.step-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; font-weight: 500; letter-spacing: .06em; text-transform: uppercase;
  color: var(--dim); white-space: nowrap;
}
.step.done .step-label   { color: var(--green); }
.step.active .step-label { color: var(--accent2); }
.step-line { flex: 1; height: 1px; background: var(--border2); min-width: 16px; transition: background .3s; }
.step-line.done { background: var(--green); }
.step.clickable { cursor: pointer; border-radius: var(--radius-sm); padding: 4px 6px; margin: -4px -6px; transition: background .18s; }
.step.clickable:hover .step-dot { border-color: var(--accent); background: var(--accent-bg); color: var(--accent2); }
.step.clickable:hover .step-label { color: var(--accent2); }

/* â”€â”€ Agent flow steps â”€â”€ */
.agent-steps { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
.agent-step {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; padding: 4px 12px;
  border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--dim);
}
.agent-step.active { border-color: var(--amber); color: var(--amber); background: var(--amber-bg); }
.agent-step.done   { border-color: var(--green); color: var(--green); background: var(--green-bg); }
.agent-step-arrow  { color: var(--border2); font-size: 10px; }

/* â”€â”€ Input â”€â”€ */
.input-field {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text);
  padding: 8px 12px;
  font-size: 12px;
  font-family: 'JetBrains Mono', monospace;
  outline: none; width: 100%;
  transition: border-color .15s;
}
.input-field:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(59,130,246,.15); }
.input-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; color: var(--dim); letter-spacing: .1em; text-transform: uppercase;
  display: block; margin-bottom: 5px;
}

/* â”€â”€ Phase header â”€â”€ */
.phase-header {
  display: flex; align-items: center; gap: 14px;
  padding: 14px 18px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-left: 3px solid var(--accent);
  border-radius: var(--radius);
  margin-bottom: 12px;
  box-shadow: var(--shadow);
}
.phase-icon  { font-size: 22px; }
.phase-title { font-size: 17px; font-weight: 700; letter-spacing: -.2px; }
.phase-sub   { font-size: 11.5px; color: var(--dim); margin-top: 2px; }

/* â”€â”€ Landing page â”€â”€ */
.landing {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  flex: 1; padding: 32px 24px; text-align: center;
  background: radial-gradient(ellipse 80% 50% at 50% -10%, rgba(59,130,246,.12) 0%, transparent 70%);
}
.landing-eyebrow {
  display: inline-flex; align-items: center; gap: 7px;
  font-family: 'JetBrains Mono', monospace; font-size: 10px;
  letter-spacing: .18em; text-transform: uppercase; color: var(--accent2);
  background: var(--accent-bg); border: 1px solid rgba(59,130,246,.25);
  padding: 4px 14px; border-radius: 100px; margin-bottom: 22px;
}
.landing-title {
  font-size: 50px; font-weight: 700; letter-spacing: -.8px; line-height: 1.12;
  color: var(--text); margin-bottom: 18px;
}
.landing-title span { color: var(--accent2); }
.landing-sub {
  font-size: 15px; color: var(--soft); max-width: 520px;
  line-height: 1.75; margin-bottom: 28px;
}
.landing-pills {
  display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 40px;
}
.landing-pill {
  font-family: 'JetBrains Mono', monospace; font-size: 10px;
  padding: 5px 13px; border-radius: 100px;
  border: 1px solid var(--border2); color: var(--muted); background: var(--surface2);
}
.landing-prompt {
  font-family: 'JetBrains Mono', monospace; font-size: 10px;
  letter-spacing: .12em; text-transform: uppercase; color: var(--dim);
  margin-bottom: 14px;
}
.product-grid {
  display: grid; grid-template-columns: 1fr; gap: 10px;
  width: 100%; max-width: 480px;
}
.product-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 16px; padding: 0;
  cursor: pointer; transition: all .22s ease; text-align: left;
  display: flex; flex-direction: column;
  box-shadow: 0 4px 20px rgba(0,0,0,.35);
  overflow: hidden;
}
.product-card:hover {
  border-color: rgba(255,255,255,.15);
  transform: translateY(-3px);
  box-shadow: 0 8px 32px rgba(0,0,0,.45);
}
.product-card-header {
  padding: 14px 18px;
  display: flex; align-items: center; gap: 12px;
}
.product-card-icon { font-size: 24px; line-height: 1; flex-shrink: 0; }
.product-card-name { font-size: 14px; font-weight: 800; color: #fff; letter-spacing: -.25px; line-height: 1.25; }
.product-card-tag {
  margin-left: auto; flex-shrink: 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; font-weight: 600; letter-spacing: .14em; text-transform: uppercase;
  color: rgba(255,255,255,.8); background: rgba(255,255,255,.16);
  border: 1px solid rgba(255,255,255,.28);
  padding: 3px 10px; border-radius: 100px;
}
.product-card-body {
  padding: 10px 18px 12px;
  display: flex; flex-direction: column; gap: 6px;
  flex: 1;
}
.product-card-desc { font-size: 12px; color: var(--muted); line-height: 1.55; }
.product-card-stats {
  display: flex; gap: 16px; padding-top: 8px;
  border-top: 1px solid var(--border); margin-top: 0;
}
.product-stat { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--muted); }
.product-stat strong { display: block; font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 1px; }
.product-card-cta {
  display: flex; align-items: center; justify-content: flex-end; margin-top: 2px;
  font-family: 'JetBrains Mono', monospace; font-size: 10px;
  color: var(--accent2); letter-spacing: .04em; opacity: 0; transition: opacity .2s;
}
.product-card:hover .product-card-cta { opacity: 1; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback} = React;

const fmt = n => '$'+Math.round(n).toLocaleString();
const wait = ms => new Promise(r => setTimeout(r, ms));

// â”€â”€ All Products â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PRODUCTS_DATA = {

  'fraud-detection': {
    icon: 'ðŸ¤–',
    gradient: 'linear-gradient(135deg, #1d4ed8, #4f46e5)',
    githubUrl: 'https://github.com/priyanka-patil-tech/fraud-detection-model.git',
    label: 'Fraud Detection',
    description: 'ML pipeline powering real-time fraud detection',
    project: { name:'Fraud Detection ML Platform', key:'ML', id:'ML-1401', backlogUrl:'https://pnp16.atlassian.net/jira/software/projects/ML/boards/backlog' },
    jiraItems: [
      { key:'ML-1405', title:'Customers call support to dispute flags â€” there is no self-service explanation page', priority:'medium', repo:'ml-inference-engine', points:5 },
      { key:'ML-1406', title:'Fraud analysts review every case manually â€” no prioritisation or risk-score queue', priority:'medium', repo:'ml-inference-engine', points:8 },
      { key:'ML-1407', title:'All merchants are treated equally â€” high-risk categories get no extra scrutiny', priority:'medium', repo:'feature-store-service', points:5 },
      { key:'ML-1408', title:'Chargeback filing is fully manual â€” each case takes two weeks and three people', priority:'medium', repo:'training-orchestrator', points:3 },
    ],
    repoData: {
      'ml-inference-engine': {
        name:'ml-inference-engine', description:'Core ML model serving & prediction API',
        language:'Python / FastAPI', files:147, stars:89, lastCommit:'3 days ago',
        debts:[
          { id:'D1', severity:'critical', type:'Batch-Only Pipeline', description:'Every fraud check joins a queue and is processed in bulk every 5 minutes. There is no way to check a single transaction the moment it happens â€” making real-time alerts impossible with the current setup.', annual_cost:520000, fix_weeks:6 },
          { id:'D2', severity:'critical', type:'No Safe Rollback', description:'If a bad model update goes live, fixing it means engineers manually swapping files on the server â€” a process that takes 4 hours and causes a full outage. There is no one-click rollback. Three incidents in the last 6 months cost the business $120K.', annual_cost:380000, fix_weeks:4 },
          { id:'D3', severity:'high', type:'One File Does Everything', description:'A single code file is responsible for 6,200 lines of logic covering loading models, cleaning data, running predictions, caching results, and monitoring â€” all tangled together. Nobody fully understands it, so any change carries high risk of breaking something else.', annual_cost:210000, fix_weeks:5 },
          { id:'D4', severity:'high', type:'Hardcoded Business Rules', description:'47 data transformation rules are scattered across 12 different files with no documentation. Changing one rule unpredictably breaks three others. Adding a new data source or updating a rule requires a full investigation before touching anything.', annual_cost:175000, fix_weeks:3 },
          { id:'D5', severity:'medium', type:'No Performance Monitoring', description:'There are no automatic checks on how well the fraud model is performing day-to-day. When accuracy drops, customers notice fraudulent transactions slipping through before the engineering team does. Average time to detect a model failure is 11 days.', annual_cost:95000, fix_weeks:2 },
        ]
      },
      'training-orchestrator': {
        name:'training-orchestrator', description:'ML training pipeline & experiment tracking',
        language:'Python / Airflow', files:89, stars:34, lastCommit:'12 days ago',
        debts:[
          { id:'D6', severity:'critical', type:'15-Month-Old Training Data', description:'The fraud model has not been retrained in 15 months. It has never seen any scam patterns that emerged in the past year. As a result, detection accuracy has fallen from 94% to 67% â€” meaning 1 in 3 fraud cases is now being missed.', annual_cost:440000, fix_weeks:5 },
          { id:'D7', severity:'high', type:'Experiments Tracked in Spreadsheets', description:'There is no system to record what data, settings, or code produced each model. Past results cannot be reproduced. If regulators ask which inputs led to a decision, the team cannot answer. Every new experiment starts from scratch with no institutional memory.', annual_cost:185000, fix_weeks:3 },
          { id:'D8', severity:'medium', type:'Training Limited to One Machine', description:'The model training process is locked to a single server and cannot be split across multiple machines. Training a large model takes up to 72 hours, limiting the team to one experiment per week and blocking engineers from trying new approaches quickly.', annual_cost:120000, fix_weeks:4 },
        ]
      },
      'feature-store-service': {
        name:'feature-store-service', description:'Centralised ML feature storage and serving',
        language:'Python / Redis / Spark', files:62, stars:21, lastCommit:'8 days ago',
        debts:[
          { id:'D9', severity:'high', type:'Test Results Don\'t Match Production', description:'The data the model is trained and tested on is calculated differently from the data it sees when running live. This mismatch causes an 8% accuracy gap between what the team sees in testing and what actually happens in production â€” giving false confidence before launch.', annual_cost:290000, fix_weeks:5 },
          { id:'D10', severity:'medium', type:'No Audit Trail for Model Inputs', description:'Nobody tracks which data inputs each model version relies on. When something changes upstream, the impact on models is invisible until a failure occurs in production. The compliance team cannot produce an audit trail, which is currently blocking regulatory approval.', annual_cost:140000, fix_weeks:2 },
        ]
      },
    },
    nego: {
      optA_items: [
        'Fraud alerts stay delayed 5+ min â€” batch pipeline blocks real-time',
        'Model accuracy stuck at 67% and falling every week',
        'Touching any data rule risks silent bugs across 12 files',
        'Regulators reject compliance dashboard â€” decisions unexplainable',
        'Bad deploys still mean 4h outage â€” no rollback exists',
      ],
      optB_items: [
        'Fraud alerts under 1 second â€” real-time pipeline replaces batch',
        'Model accuracy back to 94%+ with automated weekly retraining',
        'Data rules safe to change â€” documented, centralised, tested',
        'Every decision explainable â€” compliance unblocked',
        'One-click rollback â€” no more 4h outages from bad deploys',
      ],
      optA_stats: [
        ['Timeline', '18 weeks'], ['Success Rate', '30%'],
        ['Regression Risk', '70%'], ['Ongoing Cost', '$31K / mo'],
      ],
      optB_stats: [
        ['Refactor', '14 weeks'], ['Feature Build', '4 weeks'],
        ['Success Rate', '91%'], ['Break-Even', `Week 19`],
      ],
      negoReason: 'Every feature in this backlog depends on a model that has not been retrained in 15 months. Building real-time alerts on a batch-only pipeline produces features that ship but do not work as promised. Refactoring first (14 weeks) restores model accuracy to 91%, enables true real-time inference, and eliminates compounding debt â€” with break-even at Week 19.',
      dashFinalTitle: 'Refactor ML Infrastructure First',
      dashNote: 'The monolithic batch pipeline and 15-month-old training data are directly blocking the majority of JIRA features. Building on current infrastructure = 70% regression risk + $31K/month compounding. Refactoring enables real-time inference, auto-retraining, and XAI compliance â€”',
    },
  },

  'payment-platform': {
    icon: 'ðŸ’³',
    gradient: 'linear-gradient(135deg, #065f46, #0891b2)',
    githubUrl: 'https://github.com/priyanka-patil-tech/payment-platform.git',
    label: 'Payment Platform',
    description: 'Core payment processing & checkout infrastructure',
    project: { name:'Payment Platform', key:'PAY', id:'PAY-2001', backlogUrl:'https://pnp16.atlassian.net/jira/software/projects/PAY/boards/backlog' },
    jiraItems: [
      { key:'PAY-2005', title:'No saved payment methods â€” customers re-enter card details on every purchase', priority:'medium', repo:'payment-platform-tech-debt', points:5 },
      { key:'PAY-2006', title:'Refund process takes 7 days and requires manual approval â€” competitors do it instantly', priority:'medium', repo:'payment-platform-tech-debt', points:8 },
      { key:'PAY-2007', title:'No split payment support â€” users paying with two cards have to call support', priority:'medium', repo:'payment-platform-tech-debt', points:5 },
      { key:'PAY-2008', title:'Payment receipts are plain text emails â€” no branded template, no itemised breakdown', priority:'medium', repo:'payment-platform-tech-debt', points:3 },
    ],
    repoData: {
      'payment-platform-tech-debt': {
        name:'payment-platform-tech-debt', description:'Core payment processing & checkout platform',
        language:'Java / Spring Boot', files:312, stars:45, lastCommit:'2 days ago',
        debts:[
          { id:'P1', severity:'critical', type:'God Commons Library', description:'A single shared library is imported by all 23 microservices. Any change to it requires redeploying the entire payment platform simultaneously â€” a coordinated 3-day effort that blocks all other work. At Amazon, this exact pattern caused 3-day deploy cycles across teams.', annual_cost:268000, fix_weeks:6 },
          { id:'P2', severity:'critical', type:'Hardcoded API Keys & Config Sprawl', description:'Production API keys are hardcoded in a checked-in config file visible to anyone with repo access. On top of this, 147 feature flags are still evaluated on every payment request â€” 89 belong to experiments that ended over 2 years ago and were never cleaned up. This directly mirrors the Uber God Mode breach caused by hardcoded admin credentials.', annual_cost:312000, fix_weeks:4 },
          { id:'P3', severity:'critical', type:'Log4Shell Vulnerability (CVE-2021-44228)', description:'The shared logging library runs Log4j 1.2.17, which carries the critical Log4Shell remote code execution exploit â€” the same vulnerability that affected millions of services in 2021. It remains unpatched here, leaving the entire payment platform open to a known attack vector.', annual_cost:240000, fix_weeks:3 },
          { id:'P4', severity:'high', type:'PaymentController Does Everything', description:'One Java class handles all 15 payment methods in 4,500 lines of code. No part of payment processing can be changed without risking a break in another. Adding Apple Pay or Google Wallet means modifying this class â€” a change that currently takes 3x longer than it should due to regression risk.', annual_cost:200000, fix_weeks:5 },
          { id:'P5', severity:'high', type:'89 Dead Feature Flags Running on Every Payment', description:'89 feature flags from finished A/B experiments are still loaded and evaluated on every single payment request â€” adding latency and confusion for no benefit. When LinkedIn cleaned up a similar backlog, they saw an immediate 15% performance improvement.', annual_cost:150000, fix_weeks:2 },
          { id:'P6', severity:'medium', type:'Four Payment Providers, Four Different Patterns', description:'Each payment provider was integrated by a different team using a different approach. The Amazon Pay integration has been sitting at 45% completion for 8 months. Adding any new payment method currently requires reworking the entire integration layer from scratch.', annual_cost:120000, fix_weeks:4 },
          { id:'P7', severity:'medium', type:'800-Line Deploy Script With No Safety Net', description:'The platform is deployed via a single shell script with no error handling, no rollback, and no validation. One in every five deployments fails and requires manual intervention to recover. Knight Capital lost $440M in 45 minutes in 2012 from a deploy script with exactly this problem.', annual_cost:100000, fix_weeks:3 },
          { id:'P8', severity:'medium', type:'Critical Knowledge Exists Only in Two People\'s Heads', description:'The README says "See John for questions." John left in 2021. How the payment routing logic works is known to exactly two engineers. Onboarding a new team member currently takes 4 weeks instead of 1 week, and a single resignation could leave the team unable to safely change core payment logic.', annual_cost:80000, fix_weeks:2 },
        ]
      },
    },
    nego: {
      optA_items: [
        'Apple Pay & Google Wallet blocked â€” PaymentController too fragile to modify safely',
        'Log4Shell vulnerability unpatched â€” platform open to known remote code execution',
        'Checkout failures stay at 3.2% â€” $340K/month in abandoned carts continues',
        'PCI-DSS audit approaching â€” hardcoded API keys likely to fail compliance check',
        'Deploy failures at 20% rate â€” engineers lose 1 day per week to rollback drills',
      ],
      optB_items: [
        'Apple Pay & Google Wallet ship cleanly â€” PaymentController split into safe modules',
        'Log4Shell patched â€” platform protected before Q2 PCI-DSS audit',
        'Checkout failure rate drops â€” dead feature flags and config sprawl eliminated',
        'PCI-DSS compliance met â€” hardcoded keys removed, secrets in vault',
        'Deploys safe and fast â€” script replaced with validated, rollback-capable pipeline',
      ],
      optA_stats: [
        ['Timeline', '16 weeks'], ['Success Rate', '38%'],
        ['Regression Risk', '62%'], ['Ongoing Cost', '$19K / mo'],
      ],
      optB_stats: [
        ['Refactor', '11 weeks'], ['Feature Build', '5 weeks'],
        ['Success Rate', '89%'], ['Break-Even', 'Week 26'],
      ],
      negoReason: 'The God Commons Library means adding any new payment method touches all 23 microservices simultaneously â€” at 62% regression risk. The unpatched Log4Shell CVE and hardcoded credentials are a compliance incident waiting to happen before the Q2 audit. Refactoring takes 11 weeks, lets every payment method ship safely, and eliminates $1.47M/year in debt from Week 26 onward.',
      dashFinalTitle: 'Refactor Payment Platform First',
      dashNote: 'The God Commons Library and unpatched Log4Shell are directly blocking all JIRA features. Building on current infrastructure = 62% regression risk and a pending PCI-DSS audit failure. Refactoring enables safe modular changes, compliance, and reliable deployments â€”',
    },
  },

  'analytics-pipeline': {
    icon: 'ðŸ“ˆ',
    gradient: 'linear-gradient(135deg, #c2410c, #db2777)',
    githubUrl: 'https://github.com/priyanka-patil-tech/analytics-pipeline.git',
    label: 'Analytics Pipeline',
    description: 'Real-time event streaming & batch reporting infrastructure',
    project: { name:'Analytics Pipeline', key:'AP', id:'AP-3001', backlogUrl:'https://pnp16.atlassian.net/jira/software/projects/AP/boards/backlog' },
    jiraItems: [
      { key:'AP-3005', title:'No self-service data export â€” analysts wait 2 days for engineering to pull ad-hoc reports', priority:'medium', repo:'revenue-calculator', points:5 },
      { key:'AP-3006', title:'Dashboard has no filters or date range â€” every view shows all-time data only', priority:'medium', repo:'airflow-pipeline-service', points:5 },
      { key:'AP-3007', title:'Data quality failures are silent â€” pipeline completes with bad data and nobody knows', priority:'medium', repo:'kafka-stream-processor', points:8 },
      { key:'AP-3008', title:'No scheduled report subscriptions â€” stakeholders manually log in to check numbers each morning', priority:'medium', repo:'airflow-pipeline-service', points:3 },
    ],
    repoData: {
      'kafka-stream-processor': {
        name:'kafka-stream-processor', description:'Real-time event ingestion & Kafka consumer layer',
        language:'Python / Kafka / Flink', files:94, stars:41, lastCommit:'5 days ago',
        debts:[
          { id:'AP1', severity:'critical', type:'Triple Kafka Consumer', description:'Three separate versions of the event consumer are running simultaneously, all reading from the same Kafka topics. Version 1 still handles 40% of live traffic because nobody is confident enough to shut it down. Every event is processed two to three times, producing duplicate records in downstream reports. This is the same fear-driven architecture LinkedIn documented publicly â€” where the cost of change feels higher than the cost of running broken infrastructure forever.', annual_cost:312000, fix_weeks:5 },
          { id:'AP2', severity:'medium', type:'Alert Fatigue â€” 400 Emails a Day', description:'The monitoring system sends over 400 alert emails per day. Every engineer has created inbox rules to auto-archive them. When a real incident occurs â€” a pipeline failure, a data quality drop, a processing backlog â€” the alert arrives alongside 399 others and is not acted on until the business reports a problem hours later. PagerDuty documented this exact failure mode: alert volume destroys alert value.', annual_cost:95000, fix_weeks:2 },
        ]
      },
      'revenue-calculator': {
        name:'revenue-calculator', description:'Daily revenue reporting & SQL aggregation engine',
        language:'Python / PostgreSQL / Airflow', files:58, stars:17, lastCommit:'1 day ago',
        debts:[
          { id:'AP3', severity:'critical', type:'SQL Injection in Revenue Pipeline', description:'revenue-calculator.py builds database queries by dropping user input directly into f-strings, with no sanitisation. Any value passed through the reporting API can execute arbitrary SQL against the production database. This is the same attack vector used in Uber\'s analytics data breach. The fix takes one week â€” but every day it remains open is a day the entire revenue dataset is exposed to a single crafted request.', annual_cost:450000, fix_weeks:2 },
          { id:'AP4', severity:'critical', type:'14-Hour Job That Should Take 2 Hours', description:'The daily report generator scans the entire database without indexing, recalculates fields that have not changed, and writes results row-by-row with no batching. A job that should complete in 2 hours now runs for 14, blocking every downstream pipeline and delaying all business reporting until mid-afternoon. Airbnb documented the same pattern in their early ETL architecture â€” and fixed it in two weeks once they prioritised it.', annual_cost:280000, fix_weeks:4 },
          { id:'AP5', severity:'medium', type:'Ancient Dependencies Blocking Innovation', description:'The pipeline runs on Pandas 0.25.3 (released 2019, current is 2.2.x) and PySpark 2.4.0 (current is 3.5.x). Every modern data library â€” DuckDB, Polars, the current scikit-learn â€” requires versions incompatible with these. New engineers spend their first week finding workarounds for missing functions. Any initiative requiring modern tooling is blocked before it starts.', annual_cost:130000, fix_weeks:3 },
        ]
      },
      'airflow-pipeline-service': {
        name:'airflow-pipeline-service', description:'Airflow DAG orchestration & ETL pipeline management',
        language:'Python / Airflow / S3', files:121, stars:29, lastCommit:'9 days ago',
        debts:[
          { id:'AP6', severity:'high', type:'DAG Version Sprawl â€” 5 ETL Pipelines', description:'There are five different files named some variation of etl_pipeline in the Airflow DAGs folder. All five are active. The team does not know which version is canonical, which runs first, or whether their outputs overlap. Debugging any data discrepancy requires checking all five DAGs, which takes four times longer than it should. Spotify called this exact pattern Airflow spaghetti in their engineering blog â€” and it took a full quarter to untangle.', annual_cost:195000, fix_weeks:4 },
          { id:'AP7', severity:'high', type:'Storage Hoarding â€” 12 TB of Unidentified Data', description:'A folder called archive/ holds 12 TB of data. Nobody on the current team knows what it contains, when it was last accessed, or whether it is safe to delete. There is no data retention policy. Netflix\'s S3 cleanup project found similar zombie data and saved over $1M per year. This archive costs $18,000 per month in S3 fees for data that may have zero business value and cannot be audited for compliance.', annual_cost:216000, fix_weeks:3 },
        ]
      },
    },
    nego: {
      optA_items: [
        'Kafka v1 still running â€” every event processed 3x, duplicate data in all downstream reports',
        'SQL injection unpatched â€” one crafted API call away from a full revenue database breach',
        'Daily reports still 14 hours late â€” business decisions made on yesterday\'s numbers every day',
        'Five ETL pipelines still active â€” every data question takes 2 days to trace to a source',
        '$18K/month in unidentified S3 storage keeps compounding with no audit trail',
      ],
      optB_items: [
        'Single Kafka consumer â€” 3x infra cost eliminated, clean data lineage end-to-end',
        'SQL injection patched â€” revenue calculator secured, compliance audit ready',
        'Daily reports complete in 2 hours â€” business runs on same-day data',
        'One canonical ETL pipeline â€” debugging 4x faster, no accidental duplicate processing',
        '12 TB archive audited â€” zombie storage eliminated, data governance baseline established',
      ],
      optA_stats: [
        ['Timeline', '14 weeks'], ['Success Rate', '33%'],
        ['Regression Risk', '68%'], ['Ongoing Cost', '$26K / mo'],
      ],
      optB_stats: [
        ['Refactor', '13 weeks'], ['Feature Build', '4 weeks'],
        ['Success Rate', '94%'], ['Break-Even', 'Week 21'],
      ],
      negoReason: 'Building a real-time dashboard on a pipeline that processes every event two to three times means shipping a dashboard with numbers the business cannot trust. The SQL injection in revenue-calculator is a live breach risk on every API call. Fixing the pipeline first (13 weeks) delivers a dashboard on clean, auditable data â€” and eliminates $1.68M/year in debt from Week 21 onward.',
      dashFinalTitle: 'Refactor Analytics Infrastructure First',
      dashNote: 'Triple Kafka consumers and an unpatched SQL injection in revenue-calculator are directly blocking all pipeline improvements. Building on current infrastructure = live data breach exposure + 14-hour reporting delays compounding every single day. Refactoring eliminates the breach risk, halves reporting time, and cuts infrastructure cost â€”',
    },
  },

};


// â”€â”€ Stepper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STEPS = [
  {id:'features',  icon:'ðŸŽ«', label:'Features & Repo'},
  {id:'debt',      icon:'ðŸ¤–', label:'Debt Analysis'},
  {id:'cost',      icon:'ðŸ’°', label:'Cost Model'},
  {id:'nego',      icon:'âš–ï¸', label:'Negotiation'},
  {id:'dashboard', icon:'ðŸ“Š', label:'Report'},
];
const PHASE_ORDER = STEPS.map(s=>s.id);

function Stepper({phase, onGoTo}) {
  const current = PHASE_ORDER.indexOf(phase);
  return (
    <div className="stepper">
      {STEPS.map((s,i)=>{
        const done   = i < current;
        const active = i === current;
        return (
          <React.Fragment key={s.id}>
            <div
              className={`step ${done?'done':''} ${active?'active':''} ${done?'clickable':''}`}
              onClick={done ? () => onGoTo(s.id) : undefined}
              title={done ? `â† Back to ${s.label}` : undefined}
            >
              <div className="step-dot">{done ? 'âœ“' : s.icon}</div>
              <div className="step-label">{s.label}</div>
            </div>
            {i < STEPS.length-1 && <div className={`step-line ${i<current?'done':''}`}/>}
          </React.Fragment>
        );
      })}
    </div>
  );
}

// â”€â”€ Log panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LogPanel({logs}) {
  const [open, setOpen] = useState(false);
  const ref = useRef(null);
  useEffect(()=>{ if(ref.current) ref.current.scrollTop = ref.current.scrollHeight; },[logs]);
  return (
    <div className="log-panel" style={{width: open ? 300 : 36, transition:'width .25s ease', overflow:'hidden'}}>
      <div className="log-panel-header" style={{cursor:'pointer', justifyContent:'center', padding:'10px 8px'}}
        onClick={()=>setOpen(o=>!o)}>
        {open ? (
          <>
            <span style={{flex:1}}>Agent Logs</span>
            <span className="badge badge-live" style={{marginRight:6}}>{logs.length}</span>
            <span style={{fontSize:11, color:'var(--dim)'}}>âœ•</span>
          </>
        ) : (
          <span title="Show agent logs" style={{fontSize:14, writingMode:'vertical-rl', transform:'rotate(180deg)', color:'var(--dim)', letterSpacing:'.08em', fontFamily:"'JetBrains Mono',monospace", fontSize:'9px', textTransform:'uppercase'}}>
            Logs {logs.length > 0 ? `(${logs.length})` : ''}
          </span>
        )}
      </div>
      {open && (
        <div className="log-panel-body" ref={ref}>
          {logs.length === 0 && <div className="log-line log-dim">Waiting for activityâ€¦</div>}
          {logs.map((l,i)=>(
            <div key={i} className={`log-line log-${l.type}`}>{l.msg}</div>
          ))}
        </div>
      )}
    </div>
  );
}

// â”€â”€ Landing page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PhaseLanding({ onSelectProduct }) {
  const getStats = (p) => {
    const debts = Object.values(p.repoData).flatMap(r => r.debts);
    const totalCost = debts.reduce((s, d) => s + d.annual_cost, 0);
    const critical = debts.filter(d => d.severity === 'critical').length;
    return { count: debts.length, totalCost, critical };
  };

  return (
    <div className="landing fade-in">
      <h1 className="landing-title">
        Technical Debt<br/><span>Negotiator</span>
      </h1>

      <p className="landing-sub">
        Turn hidden engineering debt into dollar costs â€” and get a data-backed answer:
        <strong style={{color:'var(--text)'}}> refactor first, or build now?</strong>
      </p>

      <div className="landing-prompt">Click a product to analyse</div>

      <div className="product-grid">
        {Object.entries(PRODUCTS_DATA).map(([id, p]) => {
          const stats = getStats(p);
          return (
            <div key={id} className="product-card" onClick={() => onSelectProduct(id)}>
              <div className="product-card-header" style={{background: p.gradient}}>
                <div className="product-card-icon">{p.icon}</div>
                <div className="product-card-name">{p.label}</div>
              </div>
              <div className="product-card-body">
                <div className="product-card-desc">{p.description}</div>
                <div className="product-card-stats">
                  <div className="product-stat">
                    <strong>{stats.count}</strong>debt items
                  </div>
                  <div className="product-stat">
                    <strong>{stats.critical}</strong>critical
                  </div>
                  <div className="product-stat">
                    <strong>${(stats.totalCost / 1e6).toFixed(1)}M</strong>annual cost
                  </div>
                </div>
                <div className="product-card-cta">Start analysis â†’</div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”€â”€ Phase 1: JIRA Backlog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function jiraIssueUrl(key, projectKey) {
  return `https://pnp16.atlassian.net/jira/software/projects/${projectKey}/issues/${key}`;
}

// â”€â”€ Phase 1: Features & Repository â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PhaseFeatures({product, jiraItems, repoData, onScan, scanning, scanned, onContinue}) {
  return (
    <div className="fade-in" style={{display:'flex', flexDirection:'column', height:'100%'}}>

      {/* Scrollable content */}
      <div style={{flex:1, overflowY:'auto', WebkitOverflowScrolling:'touch'}}>

        <div className="phase-header" style={{marginBottom:14}}>
          <div className="phase-icon">ðŸŽ«</div>
          <div>
            <div className="phase-title">Requested Features</div>
            <div className="phase-sub">Backlog items the business wants to ship â€” each linked to a JIRA ticket.</div>
          </div>
        </div>

        <div style={{marginBottom:20}}>
          {jiraItems.map(item => (
            <div key={item.key} className="feature-item" style={{
              display:'flex', alignItems:'center', gap:12,
              padding:'11px 14px',
              border:'1px solid var(--border)',
              borderLeft:'4px solid var(--border2)',
              borderRadius:'var(--radius)',
              background:'var(--surface)',
              marginBottom:6,
            }}>
              <span className="jira-key" style={{flexShrink:0}}>{item.key}</span>
              <span className="feature-item-title" style={{flex:1, fontSize:'13px', color:'var(--soft)', lineHeight:1.4}}>{item.title}</span>
              <a href={jiraIssueUrl(item.key, product.project.key)} target="_blank" rel="noopener noreferrer"
                style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--blue)',textDecoration:'none',
                        padding:'4px 10px',border:'1px solid var(--blue-border)',borderRadius:'4px',whiteSpace:'nowrap',flexShrink:0}}>
                Open â†—
              </a>
            </div>
          ))}
        </div>

        <div style={{marginBottom:16}}>
          <div className="repo-box" style={{marginBottom:6}}>
            <div className="repo-icon">âš™ï¸</div>
            <div style={{flex:1}}>
              <div className="repo-name">{Object.values(repoData)[0].name}</div>
              <div style={{fontSize:'10px',color:'var(--dim)'}}>{Object.values(repoData)[0].description}</div>
            </div>
          </div>
          <label className="input-label">GitHub URL</label>
          <input className="input-field" readOnly value={product.githubUrl}/>
        </div>

      </div>

      {/* Button always pinned at bottom */}
      <div style={{flexShrink:0, paddingTop:12, paddingBottom:4}}>
        {!scanned ? (
          <button className="btn btn-primary btn-block" onClick={onScan} disabled={scanning}>
            {scanning ? <><span className="spin">âŸ³</span> Scanning repositoriesâ€¦</> : 'ðŸ” Scan the Repository for Tech Debts'}
          </button>
        ) : (
          <button className="btn btn-secondary btn-block" onClick={onContinue}>
            â†’ Continue to Debt Analysis
          </button>
        )}
      </div>
    </div>
  );
}

// â”€â”€ Phase 3: Debt Items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PhaseDebt({debts, selected, onToggle, onCalc, calculating, costData, onContinue}) {
  const total = debts.filter(d=>selected.includes(d.id)).reduce((s,d)=>s+d.annual_cost,0);
  return (
    <div className="fade-in">
      <div className="phase-header">
        <div className="phase-icon">ðŸ¤–</div>
        <div>
          <div className="phase-title">Debt Items Detected</div>
          <div className="phase-sub">AI-identified technical debt across linked repositories. Select items to include in cost calculation.</div>
        </div>
        <div style={{marginLeft:'auto',textAlign:'right'}}>
          <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--dim)'}}>SELECTED ANNUAL COST</div>
          <div style={{fontFamily:"'Plus Jakarta Sans',sans-serif",fontWeight:700,fontSize:'22px',color:'var(--red)'}}>{fmt(total)}</div>
        </div>
      </div>

      <div className="debt-list" style={{maxHeight:'calc(100vh - 380px)',overflowY:'auto',marginBottom:14}}>
        {debts.map(d=>(
          <div key={d.id} className={`debt-row ${d.severity}`}>
            <input type="checkbox" className="debt-checkbox"
              checked={selected.includes(d.id)}
              onChange={()=>onToggle(d.id)}/>
            <div className="debt-info">
              <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:6}}>
                <span className={`pill pill-${d.severity==='critical'?'red':d.severity==='high'?'amber':'blue'}`}>{d.severity}</span>
                <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'10px',fontWeight:700,color: d.severity==='critical'?'var(--red)':d.severity==='high'?'var(--amber)':'var(--blue)'}}>{d.type}</span>
              </div>
              <div style={{fontSize:'14px',color:'var(--text)',lineHeight:1.6}}>{d.description}</div>
            </div>
            <div className="debt-cost-tag" style={{textAlign:'right',whiteSpace:'nowrap'}}>
              <div className="debt-cost-num">{fmt(d.annual_cost)}/yr</div>
              <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--dim)'}}>if left unfixed</div>
              <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--green)',marginTop:4}}>{d.fix_weeks}w to fix</div>
            </div>
          </div>
        ))}
      </div>

      {!costData ? (
        <button className="btn btn-primary btn-block" onClick={onCalc} disabled={calculating||selected.length===0}>
          {calculating ? <><span className="spin">âŸ³</span> Calculatingâ€¦</> : `ðŸ’° Calculate Effort & Cost (${selected.length} items selected)`}
        </button>
      ) : (
        <button className="btn btn-secondary btn-block" onClick={onContinue}>
          â†’ Continue to Cost Analysis
        </button>
      )}
    </div>
  );
}

// â”€â”€ Phase 4: Cost Preview (Live) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PhaseCost({costData, selectedDebts, allDebts, onNegotiate, negotiating, negotiation, onContinue}) {
  return (
    <div className="fade-in">
      <div className="phase-header">
        <div className="phase-icon">ðŸ’°</div>
        <div>
          <div className="phase-title">What Does Fixing This Actually Cost?</div>
          <div className="phase-sub">Based on the issues selected above â€” how much to fix them, how much they save, and when you break even.</div>
        </div>
      </div>

      <div className="three-col" style={{marginBottom:14}}>
        {[
          {label:'Refactoring Cost',val:fmt(costData.refactoring_cost),cls:'amber',sub:`${costData.effort_weeks}w Ã— 4 engineers`},
          {label:'Annual Savings',val:fmt(costData.annual_savings),cls:'green',sub:'Debt costs eliminated'},
          {label:'Break-Even',val:`Wk ${costData.break_even_weeks}`,cls:'blue',sub:'Then saves forever'},
          {label:'First-Year ROI',val:`${costData.roi_pct}%`,cls:costData.roi_pct>0?'green':'red',sub:'Return on investment'},
          {label:'Critical Issues',val:costData.critical_count,cls:'red',sub:`${costData.total_count} total selected`},
          {label:'Prod Risk (Build Now)',val:'65%',cls:'red',sub:'Regression probability'},
        ].map((k,i)=>(
          <div key={i} className="kpi-box">
            <div className="kpi-label">{k.label}</div>
            <div className={`kpi-val ${k.cls}`}>{k.val}</div>
            <div className="kpi-sub">{k.sub}</div>
          </div>
        ))}
      </div>

      {/* How the numbers are calculated */}
      <div style={{background:'var(--surface2)',border:'1px solid var(--border)',borderRadius:'var(--radius)',padding:'16px 18px',marginBottom:14}}>
        <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--dim)',letterSpacing:'.1em',textTransform:'uppercase',marginBottom:12}}>
          How these numbers are calculated
        </div>
        {[
          {label:'Refactoring Cost', formula:`${costData.effort_weeks} weeks of fixing Ã— 4 engineers Ã— $8,000/engineer/week`},
          {label:'Annual Savings',   formula:'Total cost of all selected debt items if left unfixed for 12 months'},
          {label:'Break-Even',       formula:'Refactoring cost Ã· (Annual savings Ã· 52) â€” the week your investment is fully recovered'},
          {label:'First-Year ROI',   formula:'(Annual savings âˆ’ Refactoring cost) Ã· Refactoring cost Ã— 100'},
        ].map((row,i,arr)=>(
          <div key={i} style={{display:'flex',gap:12,paddingBottom:i<arr.length-1?10:0,marginBottom:i<arr.length-1?10:0,borderBottom:i<arr.length-1?'1px solid var(--border)':'none'}}>
            <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'10px',color:'var(--accent2)',flexShrink:0,minWidth:110}}>{row.label}</div>
            <div style={{fontSize:'11.5px',color:'var(--soft)',lineHeight:1.65}}>{row.formula}</div>
          </div>
        ))}
      </div>

      {!negotiation ? (
        <button className="btn btn-blue btn-block" onClick={onNegotiate} disabled={negotiating}>
          {negotiating ? <><span className="spin">âŸ³</span> Running Negotiation Agentâ€¦</> : 'âš–ï¸ Run Negotiations'}
        </button>
      ) : (
        <button className="btn btn-secondary btn-block" onClick={onContinue}>
          â†’ Continue to Negotiation
        </button>
      )}
    </div>
  );
}

// â”€â”€ Phase 5: Negotiation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PhaseNego({negotiation, costData, nego, jiraCount, onDashboard}) {
  return (
    <div className="fade-in">
      <div className="phase-header">
        <div className="phase-icon">âš–ï¸</div>
        <div>
          <div className="phase-title">Refactor vs Build</div>
          <div className="phase-sub">AI agent models both paths against your debt costs and delivery timeline.</div>
        </div>
      </div>

      {/* Option cards â€” stats only, no bullet lists */}
      <div className="nego-grid" style={{marginBottom:14}}>
        <div className="nego-card opt-a">
          <div className="nego-card-label a">OPTION A</div>
          <div className="nego-card-title">Build Features Now</div>
          {nego.optA_stats.map(([l,v],i)=>(
            <div key={i} className="nego-stat">
              <span className="nego-stat-label">{l}</span>
              <span className="nego-stat-val" style={{color:i===1||i===2?'var(--red)':undefined}}>{v}</span>
            </div>
          ))}
        </div>

        <div className="nego-vs">vs</div>

        <div className="nego-card opt-b">
          <div className="nego-card-label b">OPTION B â€” RECOMMENDED</div>
          <div className="nego-card-title">Refactor First, Then Build</div>
          {nego.optB_stats.map(([l,v],i)=>(
            <div key={i} className="nego-stat">
              <span className="nego-stat-label">{l}</span>
              <span className="nego-stat-val" style={{color:i===2?'var(--green)':undefined}}>{v}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Recommendation */}
      <div className="rec-box" style={{marginBottom:14}}>
        <div className="rec-label">âœ“ AGENT RECOMMENDATION</div>
        <div className="rec-title">Refactor First â€” Then Ship Features</div>
        <div className="rec-body" style={{marginBottom:16}}>{negotiation.reason}</div>

        <div className="nego-bullets-grid" style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}}>
          <div>
            <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--dim)',letterSpacing:'.08em',marginBottom:8}}>IF YOU BUILD NOW</div>
            {nego.optA_items.slice(0,3).map((item,i)=>(
              <div key={i} style={{fontSize:'11.5px',color:'var(--red)',lineHeight:1.85}}>âœ— {item}</div>
            ))}
          </div>
          <div>
            <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--dim)',letterSpacing:'.08em',marginBottom:8}}>AFTER REFACTORING</div>
            {nego.optB_items.slice(0,3).map((item,i)=>(
              <div key={i} style={{fontSize:'11.5px',color:'var(--green)',lineHeight:1.85}}>âœ“ {item}</div>
            ))}
          </div>
        </div>
      </div>

      <button className="btn btn-success btn-block" onClick={onDashboard}>
        ðŸ“Š View Final Dashboard â†’
      </button>
    </div>
  );
}

// â”€â”€ Phase 6: Final Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PhaseDashboard({costData, negotiation, selectedDebts, allDebts, nego, jiraItems}) {
  const debts = allDebts.filter(d=>selectedDebts.includes(d.id));
  const sevColor = s => s==='critical'?'var(--red)':s==='high'?'var(--amber)':'var(--blue)';
  const sevPill  = s => s==='critical'?'pill-red':s==='high'?'pill-amber':'pill-blue';

  return (
    <div className="fade-in">

      {/* Header */}
      <div className="phase-header" style={{borderLeftColor:'var(--green)',marginBottom:16}}>
        <div className="phase-icon">ðŸ“Š</div>
        <div style={{flex:1}}>
          <div className="phase-title">Tech Debt Report</div>
          <div className="phase-sub">Ready to share with your PM, CTO, or engineering board.</div>
        </div>
        <span className="badge badge-live">ANALYSIS COMPLETE</span>
      </div>

      {/* KPI row */}
      <div className="dash-kpi-row" style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:16}}>
        {[
          {label:'Annual Debt Cost',    val:fmt(costData.annual_savings),             cls:'red',   sub:'if left unfixed'},
          {label:'Fix Investment',      val:fmt(costData.refactoring_cost),            cls:'amber', sub:`${costData.effort_weeks}w Â· 4 engineers`},
          {label:'Break-Even',          val:`Week ${costData.break_even_weeks}`,       cls:'green', sub:'saves every week after'},
          {label:'First-Year ROI',      val:`${costData.roi_pct}%`,                   cls:costData.roi_pct>0?'green':'red', sub:'return on investment'},
          {label:'Features Unblocked',  val:`${jiraItems.length}/${jiraItems.length}`, cls:'blue',  sub:'all JIRA tickets'},
        ].map((k,i)=>(
          <div key={i} style={{background:'var(--surface)',border:'1px solid var(--border)',borderRadius:'var(--radius)',padding:'14px 16px'}}>
            <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--dim)',letterSpacing:'.08em',textTransform:'uppercase',marginBottom:6}}>{k.label}</div>
            <div className={`kpi-val ${k.cls}`} style={{fontSize:'20px',marginBottom:3}}>{k.val}</div>
            <div style={{fontSize:'10px',color:'var(--dim)'}}>{k.sub}</div>
          </div>
        ))}
      </div>

      {/* Recommendation */}
      <div className="rec-box" style={{marginBottom:16}}>
        <div className="rec-label">âœ“ RECOMMENDATION</div>
        <div className="rec-title" style={{fontSize:'17px',marginBottom:6}}>{nego.dashFinalTitle} â€” Ship Features by Week 16</div>
        <div className="rec-body">
          This platform carries <strong style={{color:'var(--red)'}}>{fmt(costData.annual_savings)}/year</strong> in quantified debt costs.
          {' '}{nego.dashNote} with 92% delivery confidence and break-even at Week {costData.break_even_weeks}.
        </div>
      </div>

      {/* Debt item summary table */}
      <div style={{background:'var(--surface)',border:'1px solid var(--border)',borderRadius:'var(--radius)',overflow:'hidden'}}>
        <div style={{padding:'10px 16px',borderBottom:'1px solid var(--border)',display:'flex',alignItems:'center',justifyContent:'space-between'}}>
          <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'10px',color:'var(--soft)',letterSpacing:'.08em',textTransform:'uppercase'}}>
            Debt Items Included ({debts.length})
          </span>
          <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'10px',color:'var(--red)'}}>
            {fmt(costData.annual_savings)}/yr total
          </span>
        </div>
        {debts.map((d,i)=>(
          <div key={d.id} style={{
            display:'flex',alignItems:'center',gap:12,
            padding:'10px 16px',
            borderBottom: i<debts.length-1 ? '1px solid var(--border)' : 'none',
            background: i%2===0 ? 'transparent' : 'rgba(255,255,255,.015)',
          }}>
            <span className={`pill ${sevPill(d.severity)}`} style={{flexShrink:0,minWidth:58,textAlign:'center'}}>{d.severity}</span>
            <span style={{flex:1,fontSize:'13px',color:'var(--text)',fontWeight:500}}>{d.type}</span>
            <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'11px',color:sevColor(d.severity),flexShrink:0}}>{fmt(d.annual_cost)}/yr</span>
            <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'10px',color:'var(--dim)',flexShrink:0,minWidth:40,textAlign:'right'}}>{d.fix_weeks}w fix</span>
          </div>
        ))}
      </div>

    </div>
  );
}

// â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [logs, setLogs] = useState([]);
  const [phase, setPhase] = useState('landing'); // landing | features | debt | cost | nego | dashboard

  // Product selection
  const [activeProduct, setActiveProduct] = useState('fraud-detection');
  const product = PRODUCTS_DATA[activeProduct];
  const activeJiraItems = product.jiraItems;
  const activeRepoData = product.repoData;
  const activeProject = product.project;
  const ALL_DEBTS = Object.values(activeRepoData).flatMap(r => r.debts);

  // Repo scan
  const [scanning, setScanning] = useState(false);
  const [scanned, setScanned] = useState(false);

  // Debt
  const [selectedDebts, setSelectedDebts] = useState([]);
  const [calculating, setCalculating] = useState(false);
  const [costData, setCostData] = useState(null);

  // Nego
  const [negotiating, setNegotiating] = useState(false);
  const [negotiation, setNegotiation] = useState(null);

  const addLog = useCallback((msg, type='info') => setLogs(l=>[...l,{msg,type}]), []);

  const selectProductFromLanding = (productId) => {
    setActiveProduct(productId);
    setPhase('features');
    setScanned(false);
    setSelectedDebts([]);
    setCostData(null);
    setNegotiation(null);
    setLogs([]);
  };

  // Compute cost live based on selected debts
  const computeCost = (ids) => {
    const items = ALL_DEBTS.filter(d=>ids.includes(d.id));
    const annual_savings = items.reduce((s,d)=>s+d.annual_cost,0);
    const effort_weeks = items.reduce((s,d)=>s+d.fix_weeks,0);
    const refactoring_cost = effort_weeks * 4 * 8000; // 4 engineers Ã— $8k/week
    const break_even_weeks = annual_savings > 0 ? Math.ceil(refactoring_cost/(annual_savings/52)) : 0;
    const roi_pct = annual_savings > 0 ? Math.round(((annual_savings-refactoring_cost)/refactoring_cost)*100) : 0;
    const critical_count = items.filter(d=>d.severity==='critical').length;
    return { annual_savings, effort_weeks, refactoring_cost, break_even_weeks, roi_pct, critical_count, total_count:items.length };
  };

  const scanAllRepos = async () => {
    setScanning(true);
    const repos = Object.values(activeRepoData);
    const totalFiles = repos.reduce((s,r) => s + r.files, 0);
    addLog(`â–¶ Scanning ${repos.length} ${repos.length===1?'repository':'repositories'} for tech debtâ€¦`,'info');
    await wait(500);
    addLog(`  ðŸ¤– Claude analyzing ${totalFiles} filesâ€¦`,'info');
    await wait(800);
    addLog(`  ðŸ” Pattern detection: god classes, batch pipelines, missing registriesâ€¦`,'info');
    await wait(600);
    const allDebts = repos.flatMap(r => r.debts);
    allDebts.forEach((d,i)=>{
      setTimeout(()=>addLog(`  âš  ${d.severity.toUpperCase()}: ${d.type} â€” ${fmt(d.annual_cost)}/yr`,d.severity==='critical'?'error':d.severity==='high'?'warn':'info'),i*150);
    });
    await wait(allDebts.length*150+400);
    addLog(`âœ“ Found ${allDebts.length} debt items (${fmt(allDebts.reduce((s,d)=>s+d.annual_cost,0))}/yr total)`,'ok');
    setSelectedDebts(allDebts.map(d=>d.id));
    setScanning(false);
    setScanned(true);
    setPhase('debt');
  };

  const toggleDebt = (id) => {
    const next = selectedDebts.includes(id) ? selectedDebts.filter(x=>x!==id) : [...selectedDebts,id];
    setSelectedDebts(next);
    if(costData) setCostData(computeCost(next));
  };

  const calcCost = async () => {
    setCalculating(true);
    addLog(`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`,'dim');
    addLog(`â–¶ Calculating refactoring economics for ${selectedDebts.length} itemsâ€¦`,'info');
    await wait(500);
    const c = computeCost(selectedDebts);
    addLog(`  âœ“ Total annual cost: ${fmt(c.annual_savings)}`,'ok');
    await wait(400);
    addLog(`  âœ“ Refactoring effort: ${c.effort_weeks}w Ã— 4 engineers Ã— $8K/wk = ${fmt(c.refactoring_cost)}`,'ok');
    await wait(500);
    addLog(`  âœ“ Break-even: Week ${c.break_even_weeks}`,'ok');
    addLog(`  âœ“ First-year ROI: ${c.roi_pct}%`,'ok');
    await wait(300);
    addLog(`âœ“ Cost model ready`,'ok');
    setCostData(c);
    setCalculating(false);
    setPhase('cost');
  };

  const runNegotiation = async () => {
    setNegotiating(true);
    addLog(`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`,'dim');
    addLog(`â–¶ Running Negotiation Agent (Claude)â€¦`,'info');
    await wait(600);
    addLog(`  âš–ï¸  Cross-referencing ${selectedDebts.length} debt items vs. ${activeJiraItems.length} JIRA ticketsâ€¦`,'info');
    await wait(700);
    const blocked = activeJiraItems.filter(t=>t.priority==='critical'||t.priority==='high');
    addLog(`  ðŸš« ${blocked.length}/${activeJiraItems.length} features blocked or critically slowed by debt`,'warn');
    const pNego = product.nego;
    const optA = pNego.optA_stats;
    const optB = pNego.optB_stats;
    await wait(500);
    addLog(`  ðŸŽ¯ Option A (Build Now): ${optA[0][1]}, ${optA[1][1]} success, ${optA[3][1]} ongoing`,'warn');
    await wait(400);
    addLog(`  ðŸŽ¯ Option B (Refactor First): ${optB[0][1]} refactor + ${optB[1][1]} build, ${optB[2][1]} success`,'info');
    await wait(600);
    addLog(`  âœ“ RECOMMENDATION: REFACTOR FIRST`,'ok');
    const nego = {
      recommendation:'refactor_first',
      reason: pNego.negoReason,
    };
    setNegotiation(nego);
    setNegotiating(false);
    setPhase('nego');
    addLog(`âœ“ Negotiation complete â€” recommendation ready`,'ok');
  };

  const goHome = () => {
    setPhase('landing');
    setScanned(false);
    setSelectedDebts([]);
    setCostData(null);
    setNegotiation(null);
    setLogs([]);
  };

  return (
    <div className="shell">
      <div className="topbar">
        <div className="logo">
          <div className="logo-mark">TD</div>
          <div className="logo-text">Tech Debt <span>Negotiator</span></div>
          <span className="badge badge-info" style={{marginLeft:8}}>AI-Powered Debt Analysis</span>
          {phase !== 'landing' && (
            <button onClick={goHome} className="btn btn-secondary" style={{marginLeft:12,padding:'5px 12px',fontSize:'11px',display:'flex',alignItems:'center',gap:5}}>
              âŒ‚ Home
            </button>
          )}
        </div>
        <div style={{display:'flex',alignItems:'center',gap:10}}>
          {costData && <span className="badge badge-warn">{fmt(costData.annual_savings)}/YR DEBT</span>}
          {negotiation && <span className="badge badge-live">ANALYSIS COMPLETE</span>}
        </div>
      </div>

      {phase !== 'landing' && <Stepper phase={phase} onGoTo={setPhase}/>}

      <div className="body-layout">
        <div className="main-area">
          {phase==='landing'   && <PhaseLanding onSelectProduct={selectProductFromLanding}/>}
          {phase==='features'  && <PhaseFeatures product={product} jiraItems={activeJiraItems} repoData={activeRepoData} onScan={scanAllRepos} scanning={scanning} scanned={scanned} onContinue={()=>setPhase('debt')}/>}
          {phase==='debt'      && <PhaseDebt debts={ALL_DEBTS} selected={selectedDebts} onToggle={toggleDebt} onCalc={calcCost} calculating={calculating} costData={costData} onContinue={()=>setPhase('cost')}/>}
          {phase==='cost'      && <PhaseCost costData={costData} selectedDebts={selectedDebts} allDebts={ALL_DEBTS} onNegotiate={runNegotiation} negotiating={negotiating} negotiation={negotiation} onContinue={()=>setPhase('nego')}/>}
          {phase==='nego'      && <PhaseNego negotiation={negotiation} costData={costData} nego={product.nego} jiraCount={activeJiraItems.length} onDashboard={()=>setPhase('dashboard')}/>}
          {phase==='dashboard' && <PhaseDashboard costData={costData} negotiation={negotiation} selectedDebts={selectedDebts} allDebts={ALL_DEBTS} nego={product.nego} jiraItems={activeJiraItems}/>}
        </div>

        {phase !== 'landing' && <LogPanel logs={logs}/>}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
